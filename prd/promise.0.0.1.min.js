function async(t){var n=new Promise(function(n){setTimeout(function(){console.log(++t),n(t)},1e3)});return n}function count(n){for(var i=0,funStr="async(0)";++i<n;)funStr+=".then(async)";eval(funStr)}~function(){var t=function(t){var n=this,s=function(t){n.resolve(t)},e=function(t){n.reject(t)};n.st="default",n.rsq=[],n.rjq=[],t(s,e)};t.fn=t.prototype,t.fn.then=function(t,n){return this.rsq.push(t),this.rjq.push(n),this},t.fn.resolve=function(t){"rejected"!==this.st&&(this.st="resolved",this.doQueue(t))},t.fn.reject=function(t){"resolved"!==this.st&&(this.st="rejected",this.doQueue(t))},t.fn.doQueue=function(n){if(this.rsq.length||this.rjq.length){var s,e=this.rsq.shift(),i=this.rjq.shift();"resolved"===this.st&&"function"==typeof e&&(s=e(n)),"rejected"===this.st&&"function"==typeof i&&(s=i(n)),s instanceof t?(s.rsq=this.rsq,s.rjq=this.rjq,this.rsq=[],this.rjq=[]):this.doQueue(s)}}}(),count(5);